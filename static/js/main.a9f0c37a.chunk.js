(this.webpackJsonpsuperchat=this.webpackJsonpsuperchat||[]).push([[0],{31:function(e,t,n){},38:function(e,t,n){"use strict";n.r(t);var r=n(3),c=n.n(r),s=n(22),a=n.n(s),o=(n(31),n(7)),i=n(23),u=n(9),l=u.a.initializeApp({apiKey:"AIzaSyDaHvjWQBPbi_8qb-53ZZYw6YlMmog89Ig",authDomain:"superchat-be9ab.firebaseapp.com",projectId:"superchat-be9ab",storageBucket:"superchat-be9ab.appspot.com",messagingSenderId:"547015847672",appId:"1:547015847672:web:427a9f137fe980ba27d50d"}),d=l.firestore(),m=l.auth(),j=n(20),g=n.p+"static/media/blond.9071513f.png",f=n.p+"static/media/green-and-black.d9d39ac6.png",h=n.p+"static/media/mustache.6c401d7b.png",b=n.p+"static/media/summer-hat.c46117c4.png",p=n.p+"static/media/dino-head.35afc71d.png",O=n.p+"static/media/black-hair.68bdd4da.png";function x(){return[{name:"blonde-hair",img:g},{name:"black-hair",img:O},{name:"dino-head",img:p},{name:"summer_hat",img:b},{name:"glasses-and-mustache",img:h},{name:"green-and-black-hair",img:f}]}var v=n.p+"static/media/spinner.97b6fbc7.svg",S=n(2);var _=function(){return Object(S.jsx)("img",{width:90,height:90,style:{margin:"2em auto",gridArea:"1/2/2/2"},src:v,alt:"loading"})};function w(e){var t=e.icon,n=e.setUserIcon,r=e.userIcon;return Object(S.jsxs)("label",{htmlFor:t.name,children:[Object(S.jsx)("input",{type:"radio",id:t.name,checked:r===t.name,value:t.name,onChange:function(e){return n(e.target.value)}}),Object(S.jsx)("img",{width:"50",height:"50",src:t.img,alt:"".concat(t.name," user icon")})]})}function N(e){var t=e.clr,n=e.setUserColor,r=e.userColor;return Object(S.jsxs)("label",{htmlFor:"".concat(t,"-color"),className:"clr-container",children:[Object(S.jsx)("input",{type:"radio",name:"radio",id:"".concat(t,"-color"),checked:r===t,value:t,onChange:function(e){return n(e.target.value)}}),Object(S.jsx)("span",{id:t,className:"checkmark"})]})}function C(e){return e.split(" ")[0]}var y=function(e){var t=e.updatingSettings,n=e.userSettingsSet,c=e.userData,s=e.setUserData,a=e.userSettingsOpen,i=e.loadingSpinnerOn,l=e.moveToChatRoom,g=m.currentUser,f=g.uid,h=g.displayName,b=x(),p=Object(r.useState)(""),O=Object(o.a)(p,2),v=O[0],y=O[1],U=Object(r.useState)(""),I=Object(o.a)(U,2),k=I[0],E=I[1],A=Object(r.useState)(""),D=Object(o.a)(A,2),F=D[0],T=D[1],R=Object(r.useState)(!1),M=Object(o.a)(R,2),V=M[0],B=M[1];function P(e){e.preventDefault();var r={chatName:void 0===v||""===v?C(h):v,chatIcon:F,themeColor:void 0===k||""===k?"pink":k};t?(i(!0),function(e,t){d.collection("users").doc(f).update(e).then((function(){a((function(){return!1})),s((function(t){var n={createdAt:t.createdAt,lastSeen:t.lastSeen,fullName:t.fullName};return Object(j.a)(Object(j.a)({},n),e)})),function(e,t){u.a.firestore().collection("messages").where("uid","==",f).get().then((function(n){n.forEach((function(t){t.ref.update({senderName:e.chatName,senderIcon:e.chatIcon,color:e.themeColor}).then((function(e){return console.log("message successfully updated")})).catch((function(e){return console.log("error happened while trying to update message:",e)}))})),t(!1)}))}(e,t)})).catch((function(e){return console.error("Error when updating user settings document: ",e)}))}(r,i)):function(e,t){n(!0);var r={createdAt:u.a.firestore.FieldValue.serverTimestamp(),lastSeen:u.a.firestore.FieldValue.serverTimestamp(),fullName:h,uid:f,chatName:e.chatName,chatIcon:e.chatIcon,themeColor:e.themeColor};d.collection("users").doc(f).set(r).then((function(){s((function(){return r})),t(!0),console.log("Document successfully added to collection!")})).catch((function(e){return console.error("Error when adding user settings document: ",e)}))}(r,l)}return Object(r.useEffect)((function(){t?(y((function(){return c.chatName})),E((function(){return c.themeColor})),T((function(){return c.chatIcon}))):y((function(){return C(h)})),B(!0)}),[]),V?Object(S.jsxs)("div",{className:"pop-up",children:[t?Object(S.jsx)("div",{className:"close_cont",children:Object(S.jsx)("i",{className:"fas fa-times close-settings",onClick:function(){return a((function(){return!1}))}})}):Object(S.jsx)(S.Fragment,{}),Object(S.jsxs)("h2",{style:{marginTop:t?"initial":"1em"},children:[t?"Update":"Choose your user"," settings"]}),Object(S.jsxs)("form",{onSubmit:function(e){return P(e)},children:[Object(S.jsxs)("div",{className:"settings__cont",children:[Object(S.jsx)("p",{children:"User name"}),Object(S.jsx)("input",{className:"settings__name",type:"text",value:v,onChange:function(e){return y(e.target.value)}})]}),Object(S.jsxs)("div",{className:"settings__cont",children:[Object(S.jsx)("p",{children:"Theme color"}),Object(S.jsxs)("div",{className:"flex",children:[Object(S.jsx)(N,{clr:"yellow",userColor:k,setUserColor:E}),Object(S.jsx)(N,{clr:"blue",userColor:k,setUserColor:E}),Object(S.jsx)(N,{clr:"purple",userColor:k,setUserColor:E}),Object(S.jsx)(N,{clr:"pink",userColor:k,setUserColor:E}),Object(S.jsx)(N,{clr:"green",userColor:k,setUserColor:E})]})]}),Object(S.jsxs)("div",{className:"settings__cont settings__icons",children:[Object(S.jsx)("p",{children:"Chat icon"}),Object(S.jsx)("div",{className:"flex",children:b.map((function(e){return Object(S.jsx)(w,{icon:e,userIcon:F,setUserIcon:T})}))})]}),Object(S.jsx)("button",{className:"btn btn__settings",type:"submit",children:"Save"})]})]}):Object(S.jsx)(_,{})},U=n(14),I=n.n(U);function k(e){for(var t,n=x(),r=0;r<n.length;r++){var c=n[r];c.name===e&&(t=c.img)}return t||O}var E=n(11),A=n(12);var D,F,T,R,M=function(e){switch(e){case"yellow":return"#FFC68A";case"green":return"#4acfac";case"pink":return"#ffa2bb";case"purple":return"#7e8ce0";case"blue":return"#36c7d0"}},V=A.a.div(D||(D=Object(E.a)(["\n  width: fit-content;\n  max-width: 90%;\n  padding: 0.5em 0.7em;\n  color: #212121;\n  border-radius: ",";\n  background-color: ",";\n"])),(function(e){return"msg__sent"===e.msgClass?"25px 25px 2px 25px":"25px 25px 25px 2px"}),(function(e){return M(e.color)})),B=A.a.div(F||(F=Object(E.a)(["\n  display: flex;\n  align-items: flex-end;\n  flex-direction: ",";\n"])),(function(e){return"msg__sent"===e.msgClass?"row-reverse":"row"})),P=A.a.p(T||(T=Object(E.a)(["\n  font-size: 0.6rem;\n  font-style: italic;\n  margin-left: ",";\n  margin-right: ",";\n  text-align: ",";\n  @media (min-width: 700px) {\n    font-size: 0.8rem;\n  }\n"])),(function(e){return"msg__sent"===e.msgClass?"auto":"3em"}),(function(e){return"msg__sent"===e.msgClass?"3em":"initial"}),(function(e){return"msg__sent"===e.msgClass?"right":"left"})),W=Object(A.a)(P)(R||(R=Object(E.a)(["\n  font-size: 0.5rem;\n  color: black;\n  letter-spacing: 1px;\n  margin-left: ",";\n  margin-right: ",";\n  @media (min-width: 700px) {\n    font-size: 0.6rem;\n  }\n"])),(function(e){return"msg__sent"===e.msgClass?"auto":"0"}),(function(e){return"msg__sent"===e.msgClass?"0":"initial"}));function z(e){var t=e.message,n=t.text,r=t.uid,c=t.imageUrl,s=t.senderName,a=t.senderIcon,o=t.color,i=t.createdAt,u=r===m.currentUser.uid?"msg__sent":"msg__received",l=function(e){var t=new Date;if(e){var n=new Date(1e3*e.seconds),r=n.getFullYear(),c=n.getMonth(),s=n.getDate(),a=n.getHours(),o=n.getMinutes();return t.getMonth()===c&&t.getDate()===s?(o<10&&(o="0"+o),"".concat(a,":").concat(o)):"".concat(s,"/").concat(c+1,"/").concat(r)}}(i);return i?Object(S.jsxs)("div",{className:"message",children:[Object(S.jsx)(P,{info:"name",msgClass:u,children:"msg__sent"===u?"You":s}),Object(S.jsxs)(B,{msgClass:u,children:[Object(S.jsx)("img",{width:25,height:25,src:k(a),alt:"".concat(a," user icon")}),Object(S.jsxs)(V,{msgClass:u,color:o,children:[c?Object(S.jsx)("img",{className:"msg__img",src:c,alt:"image message"}):Object(S.jsxs)("p",{children:[" ",n]}),Object(S.jsx)(W,{msgClass:u,children:l})]})]})]}):Object(S.jsx)(S.Fragment,{})}var L=function(e){var t=e.changingMessageSettings,n=Object(r.useRef)(),c=Object(r.useState)([]),s=Object(o.a)(c,2),a=s[0],i=s[1],u=Object(r.useState)(!0),l=Object(o.a)(u,2),m=l[0],j=l[1];return Object(r.useEffect)((function(){d.collection("messages").orderBy("createdAt").limit(100).onSnapshot((function(e){i(e.docs.map((function(e){return e.data()}))),j(!1)}))}),[]),Object(r.useEffect)((function(){m||n.current.scrollIntoView({behavior:"smooth"})}),[m]),Object(r.useEffect)((function(){m||n.current.scrollIntoView({behavior:"smooth"})}),[a]),Object(r.useEffect)((function(){j(!m)}),[t]),m?Object(S.jsx)("section",{className:"messages__container",children:Object(S.jsx)("img",{width:90,height:90,style:{margin:"2em auto"},src:v,alt:"loading"})}):Object(S.jsxs)("section",{className:"messages__container",children:[a.map((function(e,t){return Object(S.jsx)(z,{message:e},I()())})),Object(S.jsx)("div",{ref:n,style:{padding:"0.5em"}})]})};var Y=function(e){var t=e.currentUser;return Object(S.jsxs)("form",{id:"image-form",className:"img-form",action:"#",children:[Object(S.jsx)("label",{htmlFor:"mediaCapture",className:"add-image__label",children:Object(S.jsx)("i",{className:"fas fa-camera add-image__icon"})}),Object(S.jsx)("input",{onChange:function(e){return function(e,t){e.preventDefault();var n=e.target.files[0];if(document.getElementById("image-form").reset(),!n.type.match("image.*")){return}!function(e,t){var n=m.currentUser,r=n.uid,c=n.photoURL;d.collection("messages").add({createdAt:u.a.firestore.FieldValue.serverTimestamp(),uid:r,photoURL:c,color:t.themeColor,senderName:t.chatName,senderIcon:t.chatIcon,imageUrl:v}).then((function(t){var n=u.a.auth().currentUser.uid+"/"+t.id+"/"+e.name;return u.a.storage().ref(n).put(e).then((function(e){return e.ref.getDownloadURL().then((function(n){return t.update({imageUrl:n,storageUri:e.metadata.fullPath})}))}))})).catch((function(e){return console.error("There was an error uploading a file to Cloud Storage:",e)}))}(n,t)}(e,t)},id:"mediaCapture",type:"file",accept:"image/*",capture:"camera",className:"custom-file-input"})]})};var G,H,q,J=function(e){var t=e.currentUser,n=Object(r.useState)(""),c=Object(o.a)(n,2),s=c[0],a=c[1];return Object(S.jsxs)("section",{className:"form-flex",children:[Object(S.jsx)(Y,{currentUser:t}),Object(S.jsxs)("form",{className:"msg-form",onSubmit:function(e){return function(e){e.preventDefault();var n=m.currentUser,r=n.uid,c=n.photoURL;d.collection("messages").add({senderName:t.chatName,senderIcon:t.chatIcon,text:s,createdAt:u.a.firestore.FieldValue.serverTimestamp(),uid:r,photoURL:c,color:t.themeColor}).then((function(e){console.log("New message successfully added to database")})).catch((function(e){return console.log("error happened when adding new message:",e)})),a("")}(e)},children:[Object(S.jsx)("input",{type:"text",placeholder:"Send message...",value:s,onChange:function(e){return a(e.target.value)}}),Object(S.jsx)("button",{type:"submit",children:Object(S.jsx)("i",{className:"fas fa-share add-msg__icon"})})]})]})},Z=A.a.main(G||(G=Object(E.a)(["\n  width: 100%;\n  max-height: 97vh;\n  min-height: 95vh;\n  max-width: 700px;\n  display: grid;\n  grid-template-columns: 50px repeat(2, 1fr);\n  grid-template-rows: 60px repeat(3, 1fr) 60px;\n  background-color: #2d2d2d;\n  color: #e7e7e7;\n  border-radius: 20px;\n  box-shadow: rgba(0, 0, 0, 0.24) 0 3px 8px;\n  transition: all 0.3s ease-in-out;\n  @media (min-width: 600px) {\n    grid-template-columns: 200px repeat(2, 1fr);\n    grid-template-rows: 60px repeat(3, 1fr) 80px;\n  }\n"]))),K=A.a.div(H||(H=Object(E.a)(["\n  width: 100%;\n  max-width: 500px;\n  min-height: 300px;\n  padding: 1em;\n  margin: 0 auto;\n  text-align: center;\n\n  & > header h1 {\n    border-bottom: 2px solid #7e8ce0;\n  }\n\n  & > section {\n    width: 100%;\n    max-width: 400px;\n    margin: 2em auto;\n\n    & > p {\n      font-weight: bolder;\n      letter-spacing: 1px;\n    }\n  }\n"]))),Q=A.a.div(q||(q=Object(E.a)(["\n  padding: 0.5em;\n  border-radius: 50px;\n  background-color: ",";"])),(function(e){return M(e.color)}));var X=function(e){var t=e.user,n=e.currentUser;return Object(S.jsxs)("div",{className:"flex online__user",children:[Object(S.jsx)(Q,{color:t.themeColor}),Object(S.jsx)("img",{width:30,height:30,src:k(t.chatIcon),alt:"user icon"}),Object(S.jsx)("p",{children:n?"You":t.chatName})]})};var $=function e(t,n){var r=Object.prototype.toString.call(t);if(r!==Object.prototype.toString.call(n))return!1;if(["[object Array]","[object Object]"].indexOf(r)<0)return!1;var c="[object Array]"===r?t.length:Object.keys(t).length;if(c!==("[object Array]"===r?n.length:Object.keys(n).length))return!1;function s(t,n){var r=Object.prototype.toString.call(t);if(["[object Array]","[object Object]"].indexOf(r)>=0){if(!e(t,n))return!1}else{if(r!==Object.prototype.toString.call(n))return!1;if("[object Function]"===r){if(t.toString()!==n.toString())return!1}else if(t!==n)return!1}}if("[object Array]"===r){for(var a=0;a<c;a++)if(!1===s(t[a],n[a]))return!1}else for(var o in t)if(t.hasOwnProperty(o)&&!1===s(t[o],n[o]))return!1;return!0};var ee=function(e){if(e.lastSeen)return Number(e.lastSeen.seconds+"."+e.lastSeen.nanoseconds)};function te(e){var t=new Date/1e3;return ee(e)>=t-60}var ne=function(){var e=Object(r.useState)([]),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)([]),a=Object(o.a)(s,2),i=a[0],l=a[1],j=Object(r.useState)(),g=Object(o.a)(j,2),f=g[0],h=g[1],b=Object(r.useState)(!1),p=Object(o.a)(b,2),O=p[0],x=p[1],_=Object(r.useState)(0),w=Object(o.a)(_,2),N=w[0],C=w[1],y=m.currentUser.uid;return Object(r.useEffect)((function(){d.collection("users").orderBy("createdAt").limit(100).onSnapshot((function(e){c(e.docs.map((function(e){return e.data()})))}))}),[]),Object(r.useEffect)((function(){var e=function(e){for(var t=m.currentUser.uid,n=[],r=0;r<e.length;r++){var c=e[r];te(c)&&c.uid!==t&&n.push({themeColor:c.themeColor,chatIcon:c.chatIcon,chatName:c.chatName})}return n}(n);$(e,i)||l((function(){return e}))}),[n]),Object(r.useEffect)((function(){var e=setInterval((function(){C((function(e){return e+1}))}),2e4);return function(){return clearInterval(e)}}),[]),Object(r.useEffect)((function(){return d.collection("users").doc(y).get().then((function(e){e.exists?(h(e.data()),x(!0)):function(e){var t=m.currentUser,n=t.uid,r=t.displayName;d.collection("users").doc(n).set({createdAt:u.a.firestore.FieldValue.serverTimestamp(),lastSeen:u.a.firestore.FieldValue.serverTimestamp(),uid:n,name:r}).then((function(){e(!0),console.log("Document successfully added to collection!")})).catch((function(e){console.error("Error when adding document: ",e)}))}(x)})).catch((function(e){console.log("Error getting document:",e)})),function(){return console.log("unmounting...")}}),[]),Object(r.useEffect)((function(){d.collection("users").doc(y).update({lastSeen:u.a.firestore.FieldValue.serverTimestamp()}).then((function(){return console.log("Document successfully updated!")})).catch((function(e){return console.error("Error updating document: ",e)}))}),[N]),O?Object(S.jsxs)("div",{className:"users__list",children:[Object(S.jsx)("h2",{children:"Chat users "}),Object(S.jsx)(X,{user:f,currentUser:!0},I()()),i.map((function(e){return Object(S.jsx)(X,{user:e},I()())}))]}):Object(S.jsxs)("div",{className:"users__list",children:[Object(S.jsx)("h2",{children:"Chat users "}),Object(S.jsx)("img",{width:50,height:50,style:{margin:"2em auto"},src:v,alt:"loading spinner"})]})};var re=function(e){var t=e.logOff,n=e.setUserSettingsOpen,c=window.innerWidth>=600,s=Object(r.useState)(c),a=Object(o.a)(s,2),i=a[0],u=a[1];return Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("section",{className:"sidebar",children:[Object(S.jsx)("i",{className:"fas ".concat(i?"fa-times":"fa-bars"," sidebar__toggle"),onClick:function(){return function(e,t){var n=e?50:window.innerWidth>=600?200:150;document.querySelector("main").style.gridTemplateColumns="".concat(n,"px repeat(2, 1fr)"),t((function(e){return!e}))}(i,u)}}),Object(S.jsxs)("div",{className:"sidebar__content ".concat(i?"visible":"hidden"),children:[Object(S.jsx)(ne,{}),Object(S.jsxs)("button",{className:"btn btn__settings",onClick:function(){return n(!0)},children:["Settings ",Object(S.jsx)("i",{className:"fas fa-cog"})]}),Object(S.jsx)("button",{className:"btn btn__sign-out",onClick:function(){return t()},children:"Sign out"})]})]})})};var ce=function(e){var t=e.userData,n=e.logOff,c=Object(r.useState)(t),s=Object(o.a)(c,2),a=s[0],i=s[1],u=Object(r.useState)(!1),l=Object(o.a)(u,2),d=l[0],m=l[1],j=Object(r.useState)(!1),g=Object(o.a)(j,2),f=g[0],h=g[1];return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsxs)("header",{className:"chat__header",children:[Object(S.jsxs)("h2",{children:["Hello ",a.chatName,"!"]}),Object(S.jsx)("p",{children:" Welcome to Super chat!"})]}),Object(S.jsx)(re,{setUserSettingsOpen:m,logOff:n}),Object(S.jsx)(L,{changingMessageSettings:f}),Object(S.jsx)(J,{currentUser:a}),d?Object(S.jsx)(y,{updatingSettings:!0,userData:t,setUserData:i,userSettingsOpen:m,loadingSpinnerOn:h}):Object(S.jsx)(S.Fragment,{})]})};function se(){var e=new u.a.auth.GoogleAuthProvider;!function(){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!0}()?m.signInWithPopup(e).then((function(){console.log("Opening pop-up to google authentication successful")})).catch((function(e){console.log("Error getting pop up:",e)})):m.signInWithRedirect(e).then((function(){console.log("Redirecting to google authentication successful")})).catch((function(e){console.log("Error redirecting:",e)}))}var ae=function(){return Object(S.jsxs)(K,{children:[Object(S.jsx)("header",{children:Object(S.jsx)("h1",{children:"Welcome to Super Chat"})}),Object(S.jsxs)("section",{children:[Object(S.jsx)("p",{children:"So that you can start chatting with other users please sign in:"}),Object(S.jsxs)("div",{onClick:se,className:"google-btn",children:[Object(S.jsx)("div",{className:"google-icon-wrapper",children:Object(S.jsx)("img",{className:"google-icon",alt:"google logo",src:"https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg"})}),Object(S.jsx)("p",{className:"btn-text",children:Object(S.jsx)("b",{children:"Sign in with google"})})]})]})]})};var oe=function(){var e=Object(r.useState)(),t=Object(o.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)(!1),a=Object(o.a)(s,2),l=a[0],j=a[1],g=Object(r.useState)(!1),f=Object(o.a)(g,2),h=f[0],b=f[1],p=Object(r.useState)(!1),O=Object(o.a)(p,2),x=O[0],v=O[1],w=Object(i.a)(m),N=Object(o.a)(w,2),C=N[0],U=N[1];function I(){m.signOut().then((function(e){return console.log("user has signed off")})),j(!1),b(!1),v(!1)}function k(){return x||h||l?x?!h&&l?Object(S.jsx)(_,{}):h&&l?Object(S.jsx)(ce,{logOff:I,userData:n}):Object(S.jsx)(y,{updatingSettings:!1,setUserData:c,userSettingsSet:j,moveToChatRoom:b}):h&&l?Object(S.jsx)(ce,{logOff:I,userData:n}):Object(S.jsx)(_,{}):(function(){var e=m.currentUser.uid;d.collection("users").doc(e).get().then((function(e){e.exists?(c((function(){return e.data()})),j(!0),b(!0)):v(!0)})).catch((function(e){return console.log("Error when getting user document first time",e)}))}(),Object(S.jsx)(_,{}))}return Object(r.useEffect)((function(){var e=u.a.firestore.Timestamp.now().seconds-345600;d.collection("messages").where("createdAt","<",e).get().then((function(e){e.forEach((function(e){e.ref.delete().then((function(e){return console.log("element successfully deleted")}))}))}))}),[]),Object(S.jsx)(Z,{children:U?Object(S.jsx)(_,{}):C?Object(S.jsx)(k,{}):Object(S.jsx)(ae,{})})};a.a.render(Object(S.jsx)(c.a.StrictMode,{children:Object(S.jsx)(oe,{})}),document.getElementById("root"))}},[[38,1,2]]]);
//# sourceMappingURL=main.a9f0c37a.chunk.js.map